<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>if Statements - BlueRock FM Docs</title>
  
  <link rel="icon" type="image/x-icon" href="../../../assets/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../assets/css/main.css">
</head>
<body>
  <header class="navbar navbar-expand-lg bd-navbar sticky-top bg-light navbar-light">
    <nav class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
      <a class="navbar-brand" style="font-size: 20pt; font-weight: bolder" href="../../../">
       <img src="../../../assets/bluerock-cube.svg" style="height: 25pt">
       BlueRock FM Docs
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div class="input-group" id="searchGroup">
              <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
              <input type="search" id="searchInput" class="form-control bg-transparent border-0 border-bottom text-black" placeholder="Search..." aria-label="Search">
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>

    <div class="container-xxl bd-gutter mt-3 my-md-4 bd-layout" style="display: grid; grid-template-areas: 'sidebar main'; grid-template-columns: 1fr 5fr; gap: 0.5rem;">
      <aside class="bd-sidebar" style="grid-area: 'sidebar'">
        



<div class="flex-shrink-0 bg-white" style="min-width: 250pt;">
  <ul class="list-unstyled ps-0 mx-3" id="sidebar">
    
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../">Home</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#quick-start-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../quick-start/">
    Quick Start
  </a>
  <div class="collapse " id="quick-start-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../setup/">Setup</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../simple/test/">Very First Verification</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../state_basics/main/">Basics about Program State</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../primitive_reps/main/">Primitive Data</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../debugging/main/">Exploring Programs in Logic</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#learn-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../learn/">
    Learn
  </a>
  <div class="collapse show" id="learn-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#functions-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../functions/">
    Functions
  </a>
  <div class="collapse " id="functions-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/specification/">Function Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/verification/">Verifying Some Examples</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#control-flow-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../control-flow/">
    Control Flow
  </a>
  <div class="collapse show" id="control-flow-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="./" aria-current="&quot;page&quot;"><code>if</code> Statements</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../loop/">Loop Invariants</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#classes-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../class_reps/classes/">
    Classes
  </a>
  <div class="collapse " id="classes-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../class_reps/main/">Class Representation Predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../class_reps/alt/">Class Representation Predicates, alternative</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../rep_hints/main/">Hints about Reps</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../fractional-sharing/intro/">Sharing with Fractional Permissions</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#troubleshooting-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../troubleshooting/">
    Troubleshooting
  </a>
  <div class="collapse " id="troubleshooting-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../common_errors/missing_type_instances/">Dealing with Missing Type Instances</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#scaffold-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../scaffold/">
    Scaffold
  </a>
  <div class="collapse " id="scaffold-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/getting-started/">Getting Started</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/default-specs/">Using Default Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/by_hand/">Providing a Specification by Hand</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#demos-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/">
    Demos
  </a>
  <div class="collapse " id="demos-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#point-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/aggregate01/README/">
    Point
  </a>
  <div class="collapse " id="point-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point.hpp.html">Point.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_spec/">Point_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_proof/">Point_hpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#basics-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/basic/README/">
    Basics
  </a>
  <div class="collapse " id="basics-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#dataclass-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/data_class/README/">
    Dataclass
  </a>
  <div class="collapse " id="dataclass-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main_proof/">main_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#forward-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/forward_list_v1/README/">
    Forward List
  </a>
  <div class="collapse " id="forward-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test.cpp.html">test.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test_cpp_proof/">test_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#inlining-specifications-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/inline/README/">
    Inlining Specifications
  </a>
  <div class="collapse " id="inlining-specifications-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline.hpp.html">inline.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline_hpp_spec/">inline_hpp_spec.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#singly-linked-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/linked_list/README/">
    Singly-linked List
  </a>
  <div class="collapse " id="singly-linked-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.hpp.html">linked_list.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.cpp.html">linked_list.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_hpp_spec/">linked_list_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_cpp_proof/">linked_list_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#loops-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/loops/README/">
    Loops
  </a>
  <div class="collapse " id="loops-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../further-reading/">External Resources</a>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../contributing/">Feedback</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#reference-docs-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../reference/">
    Reference Docs
  </a>
  <div class="collapse " id="reference-docs-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      

      
        
      

      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.core.hints.cancelx_notation/">DSL for defining hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.core.hints.orient/">Syntax for defining hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.Arith/">Tactics for arithmetics</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.auto_frac.hints/">Automatic Fractional Splitting</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.breakpoints/">Using breakpoints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.cpp_proof/">The <code>verify</code> notation</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.delayed_case_tactics/">Join points</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.elpi.derive.bi/">Derive instances for BI predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.hints.fractional/">Common UNSAFE hints for <code>primR</code></a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.cpp.specs.inline/">Inlining during verification</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.cpp_class/">The <code>cpp.class</code> command</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.cpp_enum/">The <code>cpp.enum</code> command</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.cpp_spec/">The <code>cpp.spec</code> command</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.bwd/">Derive <code>Bwd</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.cancel/">Derive <code>Cancel</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.eager_unfold/">Derive Eager unfolding hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.equiv/">Derive equivalences for predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.fwd/">Derive <code>Fwd</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.hint_opaque/">Derive <code>Hint Opaque</code> annotations</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/bluerock.auto.elpi.derive.lazy_unfold/">Derive Lazy unfolding hints</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        


      
    
      
        


      
    
  </ul>
</div>

      </aside>
      <main class="bd-main order-1">
        
<h1><code>if</code> Statements</h1>

<div class="alert alert-info" role="alert">
  <b>Follow Along</b> by downloading the <a href="../if.v" download=""><i class="bi bi-download"></i>Rocq source of this tutorial</a>, or <a href="../../docs.tar.gz" download=""><i class="bi bi-download"></i>the full docs tarball</a>.<br>
  <small>Some code is deliberately elided for presentation purposes, the full, working source code can be downloaded with the above link.</small><br>
</div>

<p>In this tutorial, we learn how to verify code with <code>if</code>.
For this, we'll use the following function which acts like an <code>if</code>.
The specification that we will be proving is written in the comment.</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token keyword">int</span> <span class="token function">cond</span><span class="token punctuation">(</span><span class="token keyword">bool</span> test<span class="token punctuation">,</span> <span class="token keyword">int</span> thn<span class="token punctuation">,</span> <span class="token keyword">int</span> els<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>test<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> thn<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> els<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>We'll be proving the following specification:</p>
<pre class="language-coq"><code class="language-coq">cpp<span class="token punctuation">.</span>spec <span class="token string">"cond(bool, int, int)"</span> <span class="token keyword">with</span>
 <span class="token punctuation">(</span>\arg<span class="token punctuation">{</span>test<span class="token punctuation">}</span> <span class="token string">"test"</span> <span class="token punctuation">(</span>Vbool test<span class="token punctuation">)</span>
  \arg<span class="token punctuation">{</span>thn<span class="token punctuation">}</span> <span class="token string">"thn"</span> <span class="token punctuation">(</span>Vint thn<span class="token punctuation">)</span>
  \arg<span class="token punctuation">{</span>els<span class="token punctuation">}</span> <span class="token string">"els"</span> <span class="token punctuation">(</span>Vint els<span class="token punctuation">)</span>
  \post<span class="token punctuation">[</span>Vint <span class="token punctuation">(</span><span class="token keyword">if</span> test <span class="token keyword">then</span> thn <span class="token keyword">else</span> els<span class="token punctuation">)</span><span class="token punctuation">]</span> emp<span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We start off the proof in the usual way.</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Goal</span> verify<span class="token punctuation">[</span>source<span class="token punctuation">]</span> <span class="token string">"cond(bool, int, int)"</span><span class="token punctuation">.</span>
<span class="token keyword">Proof</span><span class="token punctuation">.</span>
  verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
<span class="token comment">(*
  _ : PostCond
  _ : thn_addr |-> intR 1$m thn
  _ : els_addr |-> intR 1$m els
  _ : test_addr |-> boolR 1$m test
  --------------------------------------∗
  branch.stmt source
    [region: "els" @ els_addr; "thn" @ thn_addr; "test" @ test_addr; return {?: "int"}]
    test (* &lt;&lt; the value being considered *)
    (Sseq [Sreturn (Some (Ecast Cl2r (Evar "thn" "int")))]) (Sseq [])
    (Kseq
       (wp_block source
          [region: "els" @ els_addr; "thn" @ thn_addr; "test" @ test_addr; return {?: "int"}]
          [Sreturn (Some (Ecast Cl2r (Evar "els" "int")))])
       (Kcleanup source [] (Kreturn (λ v : ptr, ▷ _PostPred_ v))))
 *)</span></code></pre>
<p>At this point, the proof is stuck on the case split which is reflected by <code>branch.stmt</code>, i.e. a statement-level branch.</p>
<h2>Manual Verification</h2>
<p>The simplest thing that we can do at this point is to use the <code>wp_if</code> tactic to tell the automation that we want to consider both cases.</p>
<pre class="language-coq"><code class="language-coq">  wp_if<span class="token punctuation">.</span>
  <span class="token comment">(*
  test = true
  → ...
    --------------------------------------∗
    ::wpS
      [region: "els" @ els_addr; "thn" @ thn_addr; "test" @ test_addr; return {?: "int"}]
      (Sseq [Sreturn (Some (Ecast Cl2r (Evar "thn" "int")))])

goal 2 (ID 1965) is:
  test = false
  → ...
    --------------------------------------∗
    ::wpS
      [region: "els" @ els_addr; "thn" @ thn_addr; "test" @ test_addr; return {?: "int"}] (Sseq [])
    *)</span></code></pre>
<p>The first case corresponds to <code>test = true</code> and the second case corresponds to <code>test = false</code>.
In both of these, the proof can be discharged trivially, and we can achieve this by running <code>all: go.</code></p>
<pre class="language-coq"><code class="language-coq">  all<span class="token punctuation">:</span> go<span class="token punctuation">.</span>
<span class="token keyword">Qed</span><span class="token punctuation">.</span></code></pre>
<p>We can also chain using a <code>;</code>, i.e. <code>wp_if; go.</code>.</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Goal</span> verify<span class="token punctuation">[</span>source<span class="token punctuation">]</span> <span class="token string">"cond(bool, int, int)"</span><span class="token punctuation">.</span>
<span class="token keyword">Proof</span><span class="token punctuation">.</span>
  verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
  wp_if<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
<span class="token keyword">Qed</span><span class="token punctuation">.</span></code></pre>
<h3>Automatic Case Splitting</h3>
<p>In cases such as this one, where the two branches of the <code>if</code> do not re-join before the end of the function, this sort of case splitting is almost always what we want to do.
To tell the automation to do this automatically, we can use a hint.</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Goal</span> verify<span class="token punctuation">[</span>source<span class="token punctuation">]</span> <span class="token string">"cond(bool, int, int)"</span><span class="token punctuation">.</span>
<span class="token keyword">Proof</span><span class="token punctuation">.</span>
  verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
  go <span class="token keyword">using</span> smash_delayed_case_no_join_B<span class="token punctuation">.</span>
<span class="token keyword">Qed</span><span class="token punctuation">.</span></code></pre>
<p>The <code>_no_join</code> part of this is introducing a guard that ensures that at least one side of the <code>if</code> statement can not finish &quot;normally&quot;.
This avoids the case split when the rest of the code might be difficult, or expensive, to verify.</p>
<p>If we want the automation to always perform the case splits for us, we can use the unguarded hint <code>smash_delayed_case_B</code> in a similar way.</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Goal</span> verify<span class="token punctuation">[</span>source<span class="token punctuation">]</span> <span class="token string">"cond(bool, int, int)"</span><span class="token punctuation">.</span>
<span class="token keyword">Proof</span><span class="token punctuation">.</span>
  verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
  go <span class="token keyword">using</span> smash_delayed_case_B<span class="token punctuation">.</span>
<span class="token keyword">Qed</span><span class="token punctuation">.</span></code></pre>
<p>This is especially useful for small functions whose implementation is effectively a single <code>if</code>.</p>
<h2>A Note</h2>
<p>Splitting the goal directly like this is quite common, but it can be a bit dangerous because it requires that we prove the code after the <code>if</code> statement for each branch.
We will discuss specifying &quot;join points&quot; in a subsequent tutorial.</p>


      </main>
    </div>

    <footer class="bd-footer py-4 py-md-5 mt-5 bg-body-tertiary">
      <center>
        <small>BlueRock Security, Inc. 2025
      </small></center>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/lunr/lunr.js"></script>
    <script>
        (async function() {
            const searchInput = document.getElementById('searchInput');
            const searchGroup = document.getElementById('searchGroup');
            const searchResults = document.createElement('div');
            searchResults.id = 'searchResults';
            searchResults.classList.add('list-group', 'mt-0');
            searchGroup.appendChild(searchResults);

            let idx;
            let docs;

            try {
                const response = await fetch("/auto-docs/search-index.json");
                docs = await response.json();

                idx = lunr(function () {
                    this.ref('url');
                    this.field('title');
                    this.field('content');

                    docs.forEach(function (doc) {
                        this.add(doc);
                    }, this);
                });
            } catch (error) {
                console.error('Error loading search index:', error);
                return;
            }

            searchInput.addEventListener('input', function() {
                const query = this.value;
                searchResults.innerHTML = '';

                if (query.length > 2) {
                    const results = idx.search(query);
                    results.forEach(result => {
                        const doc = docs.find(d => d.url === result.ref);
                        if (doc) {
                            const a = document.createElement('a');
                            a.href = '/auto-docs' + doc.url;
                            a.classList.add('list-group-item', 'list-group-item-action');
                            a.textContent = doc.title;
                            searchResults.appendChild(a);
                        }
                    });
                }
            });
        })();
    </script>
</body>
</html>
