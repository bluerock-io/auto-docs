<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Class Representation Predicates, alternative - BlueRock FM Docs</title>
  
  <link rel="icon" type="image/x-icon" href="../../../assets/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../assets/css/main.css">
</head>
<body>
  <header class="navbar navbar-expand-lg bd-navbar sticky-top bg-light navbar-light">
    <nav class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
      <a class="navbar-brand" style="font-size: 20pt; font-weight: bolder" href="../../../">
       <img src="../../../assets/bluerock-cube.svg" style="height: 25pt">
       BlueRock FM Docs
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div class="input-group">
              <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
              <input type="search" id="searchInput" class="form-control bg-transparent border-0 border-bottom text-black" placeholder="Search..." aria-label="Search">
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>

    <div class="container-xxl bd-gutter mt-3 my-md-4 bd-layout" style="display: grid; grid-template-areas: 'sidebar main'; grid-template-columns: 1fr 5fr; gap: 0.5rem;">
      <aside class="bd-sidebar" style="grid-area: 'sidebar'">
        



<div class="flex-shrink-0 bg-white" style="min-width: 250pt;">
  <ul class="list-unstyled ps-0 mx-3" id="sidebar">
    
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../">Home</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#quick-start-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../quick-start/">
    Quick Start
  </a>
  <div class="collapse " id="quick-start-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../setup/">Setup</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../simple/test/">Very First Verification</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../state_basics/main/">Basics about Program State</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../primitive_reps/main/">Primitive Data</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../debugging/main/">Exploring Programs in Logic</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#learn-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../learn/">
    Learn
  </a>
  <div class="collapse show" id="learn-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#functions-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../functions/">
    Functions
  </a>
  <div class="collapse " id="functions-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/specification/">Function Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/verification/">Verifying Some Examples</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#control-flow-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../control-flow/">
    Control Flow
  </a>
  <div class="collapse " id="control-flow-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../control_flow/if/"><code>if</code> Statements</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../control_flow/loop/">Loop Invariants</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#classes-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../classes/">
    Classes
  </a>
  <div class="collapse show" id="classes-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../main/">Class Representation Predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="./" aria-current="&quot;page&quot;">Class Representation Predicates, alternative</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../rep_hints/main/">Hints about Reps</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../fractional-sharing/intro/">Sharing with Fractional Permissions</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#troubleshooting-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../troubleshooting/">
    Troubleshooting
  </a>
  <div class="collapse " id="troubleshooting-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../common_errors/missing_type_instances/">Dealing with Missing Type Instances</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#scaffold-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../scaffold/">
    Scaffold
  </a>
  <div class="collapse " id="scaffold-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/getting-started/">Getting Started</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/default-specs/">Using Default Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/by_hand/">Providing a Specification by Hand</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#demos-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/">
    Demos
  </a>
  <div class="collapse " id="demos-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#point-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/aggregate01/README/">
    Point
  </a>
  <div class="collapse " id="point-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point.hpp.html">Point.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_spec/">Point_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_proof/">Point_hpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#basics-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/basic/README/">
    Basics
  </a>
  <div class="collapse " id="basics-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#dataclass-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/data_class/README/">
    Dataclass
  </a>
  <div class="collapse " id="dataclass-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main_proof/">main_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#forward-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/forward_list_v1/README/">
    Forward List
  </a>
  <div class="collapse " id="forward-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test.cpp.html">test.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test_cpp_proof/">test_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#inlining-specifications-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/inline/README/">
    Inlining Specifications
  </a>
  <div class="collapse " id="inlining-specifications-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline.hpp.html">inline.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline_hpp_spec/">inline_hpp_spec.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#singly-linked-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/linked_list/README/">
    Singly-linked List
  </a>
  <div class="collapse " id="singly-linked-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.hpp.html">linked_list.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.cpp.html">linked_list.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_hpp_spec/">linked_list_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_cpp_proof/">linked_list_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#loops-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/loops/README/">
    Loops
  </a>
  <div class="collapse " id="loops-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../further-reading/">External Resources</a>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../contributing/">Feedback</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#reference-docs-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../reference/">
    Reference Docs
  </a>
  <div class="collapse " id="reference-docs-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/coq-bluerock-auto-core/theories/hints/cancelx_notation/">DSL for <code>CancelX</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/coq-bluerock-auto-cpp/theories/auto/cpp/elpi/derive/bi/">Derive instances for BI predicates</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        


      
    
      
        


      
    
  </ul>
</div>

      </aside>
      <main class="bd-main order-1">
        
<h1>Class Representation Predicates, alternative</h1>

<div class="alert alert-info" role="alert">
  <b>Follow Along</b> by downloading the <a href="../alt.v" download=""><i class="bi bi-download"></i>Rocq source of this tutorial</a>, or <a href="../../docs.tar.gz" download=""><i class="bi bi-download"></i>the full docs tarball</a>.<br>
  <small>Some code is deliberately elided for presentation purposes, the full, working source code can be downloaded with the above link.</small><br>
</div>

<pre class="language-coq"><code class="language-coq">NES<span class="token punctuation">.</span>Begin Point<span class="token punctuation">.</span></code></pre>
<h2>Class Representation predicates</h2>
<p>Consider the following AST <code>source</code>, definining C++ class <code>Point</code>.</p>
<pre class="language-coq"><code class="language-coq">cpp<span class="token punctuation">.</span>prog source prog cpp<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
  class Point <span class="token punctuation">{</span>
    int x<span class="token punctuation">;</span>
    int y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span></code></pre>
<p>Just like <code>intR</code> defines the memory representation for the type <code>int</code>,
we can define <code>PointR</code> to define the memory representation for the class <code>Point</code>.
The following assertion describes a struct of type <code>Point</code> where field <code>x</code>
contains the integer <code>1</code> and field <code>y</code> contains the integer value <code>5</code>:</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Example</span> R15 <span class="token punctuation">`{</span>Σ <span class="token punctuation">:</span> cpp_logic<span class="token punctuation">}</span> <span class="token punctuation">{</span>σ<span class="token punctuation">}</span> <span class="token punctuation">(</span>q <span class="token punctuation">:</span> cQp<span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">:</span> Rep <span class="token operator">:=</span>
  structR <span class="token string">"Point"</span> q <span class="token operator">**</span>
  _field <span class="token string">"Point::x"</span>  <span class="token operator">|-</span><span class="token operator">></span> intR q <span class="token number">1</span> <span class="token operator">**</span>
  _field <span class="token string">"Point::y"</span>  <span class="token operator">|-</span><span class="token operator">></span> intR q <span class="token number">5</span><span class="token punctuation">.</span></code></pre>
<p>The above was too concrete; it stored the specific point <code>(1, 5)</code>.
Just like <code>intR</code> takes as agument a <code>z : Z</code> to denote the mathematical number being
represented, we define a Gallina record type <code>t</code> to denote the mathematical model of what is stored:</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Record</span> t <span class="token punctuation">:</span> <span class="token keyword">Type</span> <span class="token operator">:=</span> Mk
<span class="token punctuation">{</span> p_x <span class="token punctuation">:</span> Z
<span class="token punctuation">;</span> p_y <span class="token punctuation">:</span> Z
<span class="token punctuation">}</span><span class="token punctuation">.</span>

<span class="token comment">(** Then we can define the general class representation as follows: *)</span>
br<span class="token punctuation">.</span>lock
<span class="token keyword">Definition</span> R <span class="token punctuation">`{</span>Σ <span class="token punctuation">:</span> cpp_logic<span class="token punctuation">}</span> <span class="token punctuation">{</span>σ<span class="token punctuation">}</span> <span class="token punctuation">(</span>q <span class="token punctuation">:</span> cQp<span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">(</span>m <span class="token punctuation">:</span> t<span class="token punctuation">)</span><span class="token punctuation">:</span> Rep <span class="token operator">:=</span>
  structR <span class="token string">"Point"</span> q <span class="token operator">**</span>
  _field <span class="token string">"Point::x"</span>  <span class="token operator">|-</span><span class="token operator">></span> intR q m<span class="token punctuation">.(</span>p_x<span class="token punctuation">)</span> <span class="token operator">**</span>
  _field <span class="token string">"Point::y"</span>  <span class="token operator">|-</span><span class="token operator">></span> intR q m<span class="token punctuation">.(</span>p_y<span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>We derive some utility infrastructure to be used later.</p>
<pre class="language-coq"><code class="language-coq"><span class="token attribute attr-name"><span class="token punctuation">#[</span>only<span class="token punctuation">(</span>cfracsplittable<span class="token punctuation">)</span><span class="token punctuation">]</span></span> derive R<span class="token punctuation">.</span>
<span class="token attribute attr-name"><span class="token punctuation">#[</span>only<span class="token punctuation">(</span>type_ptr<span class="token operator">=</span>Point<span class="token punctuation">)</span><span class="token punctuation">]</span></span> derive R<span class="token punctuation">.</span>
<span class="token keyword">Module</span> R_Unfold<span class="token punctuation">.</span>
  <span class="token attribute attr-name"><span class="token punctuation">#[</span>only<span class="token punctuation">(</span>lazy_unfold<span class="token punctuation">(</span>export<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span></span> derive R<span class="token punctuation">.</span>
<span class="token keyword">End</span> R_Unfold<span class="token punctuation">.</span>

<span class="token keyword">Section</span> with_Σ<span class="token punctuation">.</span>
  <span class="token keyword">Context</span> <span class="token punctuation">`{</span>Σ <span class="token punctuation">:</span> cpp_logic<span class="token punctuation">}</span> <span class="token punctuation">{</span>σ<span class="token punctuation">}</span><span class="token punctuation">.</span>

  cpp<span class="token punctuation">.</span>spec <span class="token punctuation">(</span>default_ctor <span class="token string">"Point"</span><span class="token punctuation">)</span> from source <span class="token keyword">as</span> ctor_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \this this
    \post this <span class="token operator">|-</span><span class="token operator">></span> R <span class="token number">1</span>$m <span class="token punctuation">(</span>Mk <span class="token number">0</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">.</span>

  <span class="token keyword">Section</span> with_R_Unfold<span class="token punctuation">.</span>
    <span class="token keyword">Import</span> R_Unfold<span class="token punctuation">.</span>

    <span class="token keyword">Lemma</span> ctor_ok <span class="token punctuation">:</span> verify<span class="token punctuation">[</span>source<span class="token punctuation">]</span> ctor_spec<span class="token punctuation">.</span>
    <span class="token keyword">Proof</span><span class="token punctuation">.</span>
      verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
      <span class="token keyword">Import</span> MyPretty<span class="token punctuation">.</span>
      <span class="token keyword">Show</span><span class="token punctuation">.</span></code></pre>
<p>Here, the proof is stuck.
Sometimes, that means that our automation needs help to complete the proof.
But here, our program does not implement our specification, so one of the two is buggy.</p>
<p>More specifically, this is the goal:</p>
<pre class="language-coq"><code class="language-coq">  <span class="token keyword">_</span> <span class="token punctuation">:</span> this <span class="token punctuation">,</span><span class="token punctuation">,</span> o_field σ <span class="token string">"Point::x"</span> <span class="token operator">|-</span><span class="token operator">></span> uninitR <span class="token string">"int"</span> <span class="token number">1</span>$m
  <span class="token keyword">_</span> <span class="token punctuation">:</span> this <span class="token punctuation">,</span><span class="token punctuation">,</span> o_field σ <span class="token string">"Point::y"</span> <span class="token operator">|-</span><span class="token operator">></span> uninitR <span class="token string">"int"</span> <span class="token number">1</span>$m
  <span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>∗
  this <span class="token punctuation">,</span><span class="token punctuation">,</span> o_field σ <span class="token string">"Point::y"</span> <span class="token operator">|-</span><span class="token operator">></span> intR <span class="token number">1</span>$m <span class="token number">0</span> ∗ this <span class="token punctuation">,</span><span class="token punctuation">,</span> o_field σ <span class="token string">"Point::x"</span> <span class="token operator">|-</span><span class="token operator">></span> intR <span class="token number">1</span>$m <span class="token number">0</span></code></pre>
<p>Our current state says that fields <code>x</code> and <code>y</code> are not initialized, while our goal
requires them being initialized.</p>
<p>More specifically, pointer <code>this ,, o_field σ &quot;Point::x&quot;</code> (in C++, <code>&amp;(this-&gt;x)</code>) points to
<code>uninitR &quot;int&quot; 1$m</code> in the assumption, and to <code>intR 1$m 0</code> in the goal.
Same for <code>this ,, o_field σ &quot;Point::y&quot;</code> (in C++, <code>&amp;(this-&gt;y)</code>).</p>
<p>To continue, we abort the proof, and define AST <code>source1</code> with a fixed version of the code.</p>
<pre class="language-coq"><code class="language-coq">    <span class="token keyword">Abort</span><span class="token punctuation">.</span>

    cpp<span class="token punctuation">.</span>prog source1 prog cpp<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
      class Point <span class="token punctuation">{</span>
        int x<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
        int y<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span></code></pre>
<p>In the fixed AST <code>source1</code>, <code>Point</code>'s implicitly generated constructor will
initialize fields <code>x</code> and <code>y</code> to <code>0</code>.
We can then easily prove <code>Point</code>'s constructor correct against the new AST.</p>
<pre class="language-coq"><code class="language-coq">    <span class="token keyword">Lemma</span> ctor_ok <span class="token punctuation">:</span> verify<span class="token punctuation">[</span>source1<span class="token punctuation">]</span> ctor_spec<span class="token punctuation">.</span>
    <span class="token keyword">Proof</span><span class="token punctuation">.</span>
      verify_spec<span class="token punctuation">;</span> go<span class="token punctuation">.</span>
    <span class="token keyword">Qed</span><span class="token punctuation">.</span>
  <span class="token keyword">End</span> with_R_Unfold<span class="token punctuation">.</span>
<span class="token keyword">End</span> with_Σ<span class="token punctuation">.</span>

NES<span class="token punctuation">.</span><span class="token keyword">End</span> Point<span class="token punctuation">.</span></code></pre>


      </main>
    </div>

    <footer class="bd-footer py-4 py-md-5 mt-5 bg-body-tertiary">
      <center>
        <small>BlueRock Security, Inc. 2025
      </small></center>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="../../../node_modules/lunr/lunr.min.js"></script>
    <script>
        (async function() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.createElement('div');
            searchResults.id = 'searchResults';
            searchResults.classList.add('list-group', 'mt-2');
            document.body.appendChild(searchResults);

            let idx;
            let docs;

            try {
                const response = await fetch('/search.json');
                docs = await response.json();

                idx = lunr(function () {
                    this.ref('url');
                    this.field('title');
                    this.field('content');

                    docs.forEach(function (doc) {
                        this.add(doc);
                    }, this);
                });
            } catch (error) {
                console.error('Error loading search index:', error);
                return;
            }

            searchInput.addEventListener('input', function() {
                const query = this.value;
                searchResults.innerHTML = '';

                if (query.length > 2) {
                    const results = idx.search(query);
                    results.forEach(result => {
                        const doc = docs.find(d => d.url === result.ref);
                        if (doc) {
                            const a = document.createElement('a');
                            a.href = doc.url;
                            a.classList.add('list-group-item', 'list-group-item-action');
                            a.textContent = doc.title;
                            searchResults.appendChild(a);
                        }
                    });
                }
            });
        })();
    </script>
</body>
</html>
