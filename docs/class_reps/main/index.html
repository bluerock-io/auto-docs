<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Class Representation Predicates - BlueRock FM Docs</title>
  
  <link rel="icon" type="image/x-icon" href="../../../assets/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <link rel="stylesheet" href="../../../assets/css/main.css">
</head>
<body>
  <header class="navbar navbar-expand-lg bd-navbar sticky-top bg-light navbar-light">
    <nav class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
      <a class="navbar-brand" style="font-size: 20pt; font-weight: bolder" href="../../../">
       <img src="../../../assets/bluerock-cube.svg" style="height: 25pt">
       BlueRock FM Docs
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div class="input-group">
              <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
              <input type="search" id="searchInput" class="form-control bg-transparent border-0 border-bottom text-black" placeholder="Search..." aria-label="Search">
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>

    <div class="container-xxl bd-gutter mt-3 my-md-4 bd-layout" style="display: grid; grid-template-areas: 'sidebar main'; grid-template-columns: 1fr 5fr; gap: 0.5rem;">
      <aside class="bd-sidebar" style="grid-area: 'sidebar'">
        



<div class="flex-shrink-0 bg-white" style="min-width: 250pt;">
  <ul class="list-unstyled ps-0 mx-3" id="sidebar">
    
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../">Home</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#quick-start-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../quick-start/">
    Quick Start
  </a>
  <div class="collapse " id="quick-start-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../setup/">Setup</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../simple/test/">Very First Verification</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../state_basics/main/">Basics about Program State</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../primitive_reps/main/">Primitive Data</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../debugging/main/">Exploring Programs in Logic</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#learn-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../learn/">
    Learn
  </a>
  <div class="collapse show" id="learn-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#functions-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../functions/">
    Functions
  </a>
  <div class="collapse " id="functions-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/specification/">Function Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../functions/verification/">Verifying Some Examples</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#control-flow-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../control-flow/">
    Control Flow
  </a>
  <div class="collapse " id="control-flow-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../control_flow/if/"><code>if</code> Statements</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../control_flow/loop/">Loop Invariants</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#classes-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../classes/">
    Classes
  </a>
  <div class="collapse show" id="classes-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="./" aria-current="&quot;page&quot;">Class Representation Predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../alt/">Class Representation Predicates, alternative</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../rep_hints/main/">Hints about Reps</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../fractional-sharing/intro/">Sharing with Fractional Permissions</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#troubleshooting-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../troubleshooting/">
    Troubleshooting
  </a>
  <div class="collapse " id="troubleshooting-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../common_errors/missing_type_instances/">Dealing with Missing Type Instances</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#scaffold-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../scaffold/">
    Scaffold
  </a>
  <div class="collapse " id="scaffold-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/getting-started/">Getting Started</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/default-specs/">Using Default Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../scaffold/by_hand/">Providing a Specification by Hand</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#demos-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/">
    Demos
  </a>
  <div class="collapse " id="demos-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#point-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/aggregate01/README/">
    Point
  </a>
  <div class="collapse " id="point-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point.hpp.html">Point.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_spec/">Point_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/aggregate01/Point_hpp_proof/">Point_hpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#basics-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/basic/README/">
    Basics
  </a>
  <div class="collapse " id="basics-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/basic/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#dataclass-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/data_class/README/">
    Dataclass
  </a>
  <div class="collapse " id="dataclass-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/data_class/main_proof/">main_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#forward-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/forward_list_v1/README/">
    Forward List
  </a>
  <div class="collapse " id="forward-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test.cpp.html">test.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/forward_list_v1/test_cpp_proof/">test_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#inlining-specifications-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/inline/README/">
    Inlining Specifications
  </a>
  <div class="collapse " id="inlining-specifications-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline.hpp.html">inline.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/inline/inline_hpp_spec/">inline_hpp_spec.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#singly-linked-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/linked_list/README/">
    Singly-linked List
  </a>
  <div class="collapse " id="singly-linked-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.hpp.html">linked_list.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list.cpp.html">linked_list.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_hpp_spec/">linked_list_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/linked_list/linked_list_cpp_proof/">linked_list_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#loops-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../demo/loops/README/">
    Loops
  </a>
  <div class="collapse " id="loops-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../demo/loops/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../further-reading/">External Resources</a>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../contributing/">Feedback</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#reference-docs-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../../reference/">
    Reference Docs
  </a>
  <div class="collapse " id="reference-docs-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/coq-bluerock-auto-core/theories/hints/cancelx_notation/">DSL for <code>CancelX</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../../reference/coq-bluerock-auto-cpp/theories/auto/cpp/elpi/derive/bi/">Derive instances for BI predicates</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        


      
    
      
        


      
    
  </ul>
</div>

      </aside>
      <main class="bd-main order-1">
        
<h1>Class Representation Predicates</h1>

<div class="alert alert-info" role="alert">
  <b>Follow Along</b> by downloading the <a href="../main.v" download=""><i class="bi bi-download"></i>Rocq source of this tutorial</a>, or <a href="../../docs.tar.gz" download=""><i class="bi bi-download"></i>the full docs tarball</a>.<br>
  <small>Some code is deliberately elided for presentation purposes, the full, working source code can be downloaded with the above link.</small><br>
</div>

<p>In this document, we demonstrate how to specify a class.</p>
<p>We specify a class in three steps:</p>
<ol>
<li>We write the <strong>model</strong> of the class, i.e. what a value of this class &quot;means&quot;
at an intuitive, abstract level.</li>
<li>We write the <strong>representation predicate</strong> of the class, i.e. how the model is
implemented using C++ resources.</li>
<li>We specify the member functions using the representation predicate.</li>
</ol>
<h2>The Program</h2>
<p>Here, we define the AST <code>source</code> containing our example C++ program:</p>
<pre class="language-coq"><code class="language-coq">cpp<span class="token punctuation">.</span>prog source prog cpp<span class="token punctuation">:</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
  <span class="token keyword">struct</span> IntCell <span class="token punctuation">{</span>
    int n<span class="token punctuation">{</span><span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    void method<span class="token punctuation">(</span><span class="token punctuation">)</span> const <span class="token punctuation">{</span><span class="token punctuation">}</span>
    IntCell<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span> default<span class="token punctuation">;</span>
    IntCell<span class="token punctuation">(</span>int _n<span class="token punctuation">)</span><span class="token punctuation">:</span> n<span class="token punctuation">(</span>_n<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  void test<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    IntCell m<span class="token punctuation">;</span>
    m<span class="token punctuation">.</span>method<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">.</span></code></pre>
<h2>The Model</h2>
<p>To formalize the type <code>IntCell</code>, we define a type <code>IntCellT</code> as the <em>model</em> of <code>IntCell</code>. A value
of type <code>IntCellT</code> describes the data inside an instance of <code>IntCell</code>.
Since <code>IntCell</code> is a C++ struct with one field of type <code>int</code>,
and we use Rocq type <code>Z</code> of signed integers as model for <code>int</code> (via
representation predicate <code>intR</code>),
our model will be a Rocq record with one field of type <code>Z</code>.</p>
<pre class="language-coq"><code class="language-coq"><span class="token keyword">Record</span> IntCellT <span class="token operator">:=</span> MkT <span class="token punctuation">{</span>
  foo_n <span class="token punctuation">:</span> Z
<span class="token punctuation">}</span><span class="token punctuation">.</span></code></pre>
<h2>The Representation Predicate</h2>
<p>In <a href="../../state_basics/main">state basics</a> we saw how <code>intR</code> lets us represent the state
of a variable of type <code>int</code>. That is, <code>intR</code> is the representation predicate for type <code>int</code>.</p>
<p>Next, we define the representation predicate for class <code>IntCell</code>.
This will be a function <code>IntCellR : cQp.t -&gt; IntCellT -&gt; Rep</code>.</p>
<p>Assertion <code>p |-&gt; IntCellR q m</code> gives ownership <code>q</code> of a <code>IntCell</code> instance whose content matches the
model <code>m</code>, living at location <code>p</code>. Concretely, we define <code>IntCellR</code> as follows:</p>
<pre class="language-coq"><code class="language-coq">  <span class="token keyword">Definition</span> IntCellR <span class="token punctuation">(</span>q <span class="token punctuation">:</span> cQp<span class="token punctuation">.</span>t<span class="token punctuation">)</span> <span class="token punctuation">(</span>m <span class="token punctuation">:</span> IntCellT<span class="token punctuation">)</span> <span class="token punctuation">:</span> Rep <span class="token operator">:=</span>
    _field <span class="token string">"IntCell::n"</span> <span class="token operator">|-</span><span class="token operator">></span> intR q m<span class="token punctuation">.(</span>foo_n<span class="token punctuation">)</span> <span class="token operator">**</span>
    structR <span class="token string">"IntCell"</span> q<span class="token punctuation">.</span></code></pre>
<p>This definition describes the layout of type <code>IntCell</code>.
In many cases, such representation predicate can be generated, but we define
it ourselves to explain how these work.</p>
<p>We use <code>intR q m.(foo_n)</code> because field <code>IntCell::n</code> contains an
integer with value <code>m.(foo_n)</code>.
We offset that representation predicate with <code>_field &quot;IntCell::n&quot;</code> because this
integer does not live at location <code>p</code> (which points to the whole object) but
at location <code>p ,, _field &quot;IntCell::n&quot;</code>.</p>
<p>This works because when we define a <code>Rep</code>, the <code>x |-&gt; R</code> operator is
overloaded to expect <code>x</code> to be a pointer <em>offset</em> <code>o</code> instead of a pointer.</p>
<p><code>structR &quot;IntCell&quot; q</code> means we own <code>q</code> fraction of a <code>IntCell</code> instance; <code>structR</code> is
used for all <code>struct</code> and <code>class</code> aggregate C++ types.</p>
<h2>The Specifications</h2>
<p>Next, we specify <code>IntCell</code> constructors, destructor, and methods.</p>
<p>Such specifications typically need to refer to the object being constructor,
destructed, or on which the method is being invoked --- the <em>receiver</em>.
To that end, they can use <code>\this p</code> and then for instance <code>p |-&gt; IntCellR   1$m m</code>. <code>\this p</code> binds pointer <code>p</code> to the receiver object in the rest of the
spec, and <code>p |-&gt; IntCellR 1$m m</code> asserts full ownership of that object.</p>
<p>First, we specify the default constructor.</p>
<pre class="language-coq"><code class="language-coq">  cpp<span class="token punctuation">.</span>spec <span class="token string">"IntCell::IntCell()"</span> <span class="token keyword">as</span> default_ctor_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \this this
    \post this <span class="token operator">|-</span><span class="token operator">></span> IntCellR <span class="token number">1</span>$m <span class="token punctuation">(</span>MkT <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Invoking any constructor returns full ownership <code>1$m</code> to a new object.
The <code>IntCell</code> default constructor initializes <code>IntCell::m</code> to <code>0</code>, so the
default model for the new object is <code>MkT 0</code>.</p>
<p>Next we specify a non-default constructor <code>IntCell(int)</code>; this spec is
similar, but <code>IntCell(n)</code> will produce an object with model <code>MkT n</code> instead of
<code>MkT 0</code>. <code>\arg{n} &quot;_n&quot; (Vint n)</code> binds the C++ argument <code>_n</code>'s value to the
variable <code>n</code>.</p>
<pre class="language-coq"><code class="language-coq">  cpp<span class="token punctuation">.</span>spec <span class="token string">"IntCell::IntCell(int)"</span> <span class="token keyword">as</span> int_ctor_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \this this
    \arg<span class="token punctuation">{</span>n<span class="token punctuation">}</span> <span class="token string">"_n"</span> <span class="token punctuation">(</span>Vint n<span class="token punctuation">)</span>
    \post this <span class="token operator">|-</span><span class="token operator">></span> IntCellR <span class="token number">1</span>$m <span class="token punctuation">(</span>MkT n<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Conversely, <code>IntCell</code>'s destructor consumes full ownership <code>1$m</code> of a <code>IntCell</code>
instance with any model, and returns no ownership.</p>
<pre class="language-coq"><code class="language-coq">  cpp<span class="token punctuation">.</span>spec <span class="token string">"IntCell::~IntCell()"</span> <span class="token keyword">as</span> dtor_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \this this
    \pre<span class="token punctuation">{</span>m<span class="token punctuation">}</span> this <span class="token operator">|-</span><span class="token operator">></span> IntCellR <span class="token number">1</span>$m m
    \post emp<span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>
<p>Next, we have the specification of a method that does nothing.
<code>\prepost P</code> means that <code>P</code> is used in both the pre-condition and the post-condition of the specification.</p>
<pre class="language-coq"><code class="language-coq">  cpp<span class="token punctuation">.</span>spec <span class="token string">"IntCell::method() const"</span> <span class="token keyword">as</span> method_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \this this
    <span class="token comment">(* Since this method does _not_ modify its receiver, this method doesn't
    need full ownership of [IntCellR] and just borrows partial ownership [q].
    *)</span>
    \prepost<span class="token punctuation">{</span>q m<span class="token punctuation">}</span> this <span class="token operator">|-</span><span class="token operator">></span> IntCellR q m
    \post emp<span class="token punctuation">)</span><span class="token punctuation">.</span>

  cpp<span class="token punctuation">.</span>spec <span class="token string">"test()"</span> <span class="token keyword">as</span> test_spec <span class="token keyword">with</span> <span class="token punctuation">(</span>
    \post emp<span class="token punctuation">)</span><span class="token punctuation">.</span></code></pre>


      </main>
    </div>

    <footer class="bd-footer py-4 py-md-5 mt-5 bg-body-tertiary">
      <center>
        <small>BlueRock Security, Inc. 2025
      </small></center>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="../../../node_modules/lunr/lunr.min.js"></script>
    <script>
        (async function() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.createElement('div');
            searchResults.id = 'searchResults';
            searchResults.classList.add('list-group', 'mt-2');
            document.body.appendChild(searchResults);

            let idx;
            let docs;

            try {
                const response = await fetch('/search.json');
                docs = await response.json();

                idx = lunr(function () {
                    this.ref('url');
                    this.field('title');
                    this.field('content');

                    docs.forEach(function (doc) {
                        this.add(doc);
                    }, this);
                });
            } catch (error) {
                console.error('Error loading search index:', error);
                return;
            }

            searchInput.addEventListener('input', function() {
                const query = this.value;
                searchResults.innerHTML = '';

                if (query.length > 2) {
                    const results = idx.search(query);
                    results.forEach(result => {
                        const doc = docs.find(d => d.url === result.ref);
                        if (doc) {
                            const a = document.createElement('a');
                            a.href = doc.url;
                            a.classList.add('list-group-item', 'list-group-item-action');
                            a.textContent = doc.title;
                            searchResults.appendChild(a);
                        }
                    });
                }
            });
        })();
    </script>
</body>
</html>
