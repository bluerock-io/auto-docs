<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>Providing a Specification by Hand - BlueRock FM Docs</title>
  
  <link rel="icon" type="image/x-icon" href="../../assets/favicon.ico">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link href="https://unpkg.com/prismjs@1.20.0/themes/prism-okaidia.css" rel="stylesheet">
  <link rel="stylesheet" href="../../assets/css/main.css">
</head>
<body>
  <header class="navbar navbar-expand-lg bd-navbar sticky-top bg-light navbar-light">
    <nav class="container-xxl bd-gutter flex-wrap flex-lg-nowrap">
      <a class="navbar-brand" style="font-size: 20pt; font-weight: bolder" href="../../">
       <img src="../../assets/bluerock-cube.svg" style="height: 25pt">
       BlueRock FM Docs
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <div class="input-group">
              <span class="input-group-text bg-transparent border-0"><i class="bi bi-search"></i></span>
              <input type="search" id="searchInput" class="form-control bg-transparent border-0 border-bottom text-black" placeholder="Search..." aria-label="Search">
            </div>
          </li>
        </ul>
      </div>
    </nav>
  </header>

    <div class="container-xxl bd-gutter mt-3 my-md-4 bd-layout" style="display: grid; grid-template-areas: 'sidebar main'; grid-template-columns: 1fr 5fr; gap: 0.5rem;">
      <aside class="bd-sidebar" style="grid-area: 'sidebar'">
        



<div class="flex-shrink-0 bg-white" style="min-width: 250pt;">
  <ul class="list-unstyled ps-0 mx-3" id="sidebar">
    
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../">Home</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#quick-start-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../quick-start/">
    Quick Start
  </a>
  <div class="collapse " id="quick-start-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../setup/">Setup</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/simple/test/">Very First Verification</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/state_basics/main/">Basics about Program State</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/primitive_reps/main/">Primitive Data</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/debugging/main/">Exploring Programs in Logic</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#learn-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../learn/">
    Learn
  </a>
  <div class="collapse " id="learn-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#functions-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../docs/functions/">
    Functions
  </a>
  <div class="collapse " id="functions-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/functions/specification/">Function Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/functions/verification/">Verifying Some Examples</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#control-flow-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../docs/control-flow/">
    Control Flow
  </a>
  <div class="collapse " id="control-flow-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/control_flow/if/"><code>if</code> Statements</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/control_flow/loop/">Loop Invariants</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#classes-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../docs/class_reps/classes/">
    Classes
  </a>
  <div class="collapse " id="classes-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/class_reps/main/">Class Representation Predicates</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/class_reps/alt/">Class Representation Predicates, alternative</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/rep_hints/main/">Hints about Reps</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/fractional-sharing/intro/">Sharing with Fractional Permissions</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#troubleshooting-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../troubleshooting/">
    Troubleshooting
  </a>
  <div class="collapse " id="troubleshooting-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../docs/common_errors/missing_type_instances/">Dealing with Missing Type Instances</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#scaffold-collapse" aria-expanded="true">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../">
    Scaffold
  </a>
  <div class="collapse show" id="scaffold-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../getting-started/">Getting Started</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../default-specs/">Using Default Specifications</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="./" aria-current="&quot;page&quot;">Providing a Specification by Hand</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#demos-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/">
    Demos
  </a>
  <div class="collapse " id="demos-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#point-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/aggregate01/README/">
    Point
  </a>
  <div class="collapse " id="point-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/aggregate01/Point.hpp.html">Point.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/aggregate01/Point_hpp_spec/">Point_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/aggregate01/Point_hpp_proof/">Point_hpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#basics-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/basic/README/">
    Basics
  </a>
  <div class="collapse " id="basics-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/basic/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/basic/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#dataclass-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/data_class/README/">
    Dataclass
  </a>
  <div class="collapse " id="dataclass-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/data_class/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/data_class/main_proof/">main_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#forward-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/forward_list_v1/README/">
    Forward List
  </a>
  <div class="collapse " id="forward-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/forward_list_v1/test.cpp.html">test.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/forward_list_v1/test_cpp_proof/">test_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#inlining-specifications-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/inline/README/">
    Inlining Specifications
  </a>
  <div class="collapse " id="inlining-specifications-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/inline/inline.hpp.html">inline.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/inline/inline_hpp_spec/">inline_hpp_spec.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#singly-linked-list-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/linked_list/README/">
    Singly-linked List
  </a>
  <div class="collapse " id="singly-linked-list-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/linked_list/linked_list.hpp.html">linked_list.hpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/linked_list/linked_list.cpp.html">linked_list.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/linked_list/linked_list_hpp_spec/">linked_list_hpp_spec.v</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/linked_list/linked_list_cpp_proof/">linked_list_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
        
          

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#loops-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../demo/loops/README/">
    Loops
  </a>
  <div class="collapse " id="loops-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/loops/main.cpp.html">main.cpp</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../demo/loops/main_cpp_proof/">main_cpp_proof.v</a>
</li>


        
      
    </ul>
  </div>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../further-reading/">External Resources</a>
</li>


      
    
      
        

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../contributing/">Feedback</a>
</li>


      
    
      
        

<li class="mb-1">
  
  <button class="btn sidebar-toggle align-items-center rounded px-1" data-bs-toggle="collapse" data-bs-target="#reference-docs-collapse">
  </button>
  <a class="nav-link px-0" style="display: inline" href="../../reference/">
    Reference Docs
  </a>
  <div class="collapse " id="reference-docs-collapse">
    <ul class="sidebar-toggle-nav list-unstyled fw-normal pb-1 small px-4">
      
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../reference/coq-bluerock-auto-core/theories/hints/cancelx_notation/">DSL for <code>CancelX</code> hints</a>
</li>


        
      
        
          

<li class="mb-1">
  <a class="nav-link" style="margin-left: 1.5rem" href="../../reference/coq-bluerock-auto-cpp/theories/auto/cpp/elpi/derive/bi/">Derive instances for BI predicates</a>
</li>


        
      
    </ul>
  </div>
</li>


      
    
      
        


      
    
      
        


      
    
  </ul>
</div>

      </aside>
      <main class="bd-main order-1">
        
<h1>Providing a Specification by Hand</h1>
<div class="alert alert-info" role="alert">
<p>This tutorial builds on the <a href="../getting-started/">Getting Started with Scaffold</a> tutorial.</p>
</div>
<p>In the <a href="../default-specs/">previous chapter</a>, we asked
<code>scaffold</code> to generate a default specification in order to prove memory safety
of a simple <code>swap</code> function. This tutorial builds upon the previous chapter by
demonstrating how to manually provide a specification for <code>swap</code> that fully
specifies the functions behavior. We assumes that the <code>example/</code> directory has been
initialized with <code>scaffold init</code> and that all the files of the previous chapter
are still present.</p>
<p>We start by creating a copy of the <code>swap</code> function in a new <code>cpp</code> file
<code>src/stage2.cpp</code>. The code is unchanged from the previous chapter:</p>
<pre class="language-cpp"><code class="language-cpp"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;cstddef></span></span>

<span class="token keyword">void</span> <span class="token function">swap</span><span class="token punctuation">(</span>size_t<span class="token operator">&amp;</span> x<span class="token punctuation">,</span> size_t<span class="token operator">&amp;</span> y<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    size_t tmp <span class="token operator">=</span> y<span class="token punctuation">;</span>
    y <span class="token operator">=</span> x<span class="token punctuation">;</span>
    x <span class="token operator">=</span> tmp<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>To make sure scaffold understands the new file, we re-run our <code>bear</code> and <code>clang</code> combination command and add the newly created file.</p>
<pre class="language-shell"><code class="language-shell">$ bear -- clang <span class="token parameter variable">-c</span> src/stage1.cpp <span class="token parameter variable">-c</span> src/stage2.cpp</code></pre>
<p>Since we updated <code>compile_commands.json</code>, we need to inform <code>scaffold</code> of the change using</p>
<pre class="language-shell"><code class="language-shell">$ scaffold gen</code></pre>
<p>Now that <code>scaffold</code> understands how to build <code>stage2.cpp</code>, we proceed by running
<code>scaffold verify</code>. This time, we will pass a <code>--filename</code> argument to ask <code>scaffold</code> to focus on a specific file.</p>
<pre class="language-shell"><code class="language-shell">$ scaffold verify <span class="token parameter variable">--filename</span> src/stage2.cpp</code></pre>
<p>We select the <code>swap</code> function and then choose <code>By hand</code>, and press <strong>e</strong> to open an
editor. <code>scaffold</code> pre-populates the temporary file with specifiers for the
function arguments but leaves the rest to us. (<code>\post emp</code> indicates an trivial
postcondition.)</p>
<pre class="language-coq"><code class="language-coq">\arg<span class="token punctuation">{</span>x<span class="token punctuation">}</span> <span class="token string">"x"</span> <span class="token punctuation">(</span>Vref x<span class="token punctuation">)</span>
\arg<span class="token punctuation">{</span>y<span class="token punctuation">}</span> <span class="token string">"y"</span> <span class="token punctuation">(</span>Vref y<span class="token punctuation">)</span>
\post emp</code></pre>
<p>Building on the default specification that we inspected at the <a href="../default-specs/">end of the previous chapter</a>, we want to extend <code>scaffold</code>'s bare-bones specification to
properly specify a) the two function arguments of <code>swap</code> and their contents, as
well as b) <code>swap</code>'s precise postcondition, i.e. the fact it swaps the contents
of its arguments. We thus change the provided specification to:</p>
<pre class="language-coq"><code class="language-coq">\arg<span class="token punctuation">{</span>x_addr<span class="token punctuation">}</span> <span class="token string">"x"</span> <span class="token punctuation">(</span>Vptr x_addr<span class="token punctuation">)</span>
\pre<span class="token punctuation">{</span>x<span class="token punctuation">}</span> x_addr <span class="token operator">|-</span><span class="token operator">></span> ulongR <span class="token number">1</span>$m x 
\arg<span class="token punctuation">{</span>y_addr<span class="token punctuation">}</span> <span class="token string">"y"</span> <span class="token punctuation">(</span>Vptr y_addr<span class="token punctuation">)</span>
\pre<span class="token punctuation">{</span>y<span class="token punctuation">}</span> y_addr <span class="token operator">|-</span><span class="token operator">></span> ulongR <span class="token number">1</span>$m y 
\post 
  x_addr <span class="token operator">|-</span><span class="token operator">></span> ulongR <span class="token number">1</span>$m y <span class="token operator">**</span>
  y_addr <span class="token operator">|-</span><span class="token operator">></span> ulongR <span class="token number">1</span>$m x</code></pre>
<p>Compared to the default specification from the previous chapter, we have made
one important change as well as several small cosmetic changes to make the
specification more idiomatic and easier to read.</p>
<ol>
<li>Most importantly, we removed the existential quantifiers from the
postcondition. Instead of merely requiring the references to contain any two
numbers, we now specify exactly that the reference <code>x</code> must contain the
initial value of <code>y</code> and vice versa.</li>
<li>To make the specification a bit more readable, we omit the types of our
verification variables. The syntax <code>\arg{x_addr}</code> is shorthand for
<code>\arg{(x_addr : _)}</code> which indicates to Rocq that it should infer the type
from the variable's usage.</li>
<li>We introduce the verification variables for the references' contents (<code>x</code> and
<code>y</code>) only where we first need them. Similarly to <code>\arg{..}</code>, the syntax
<code>\pre{..}</code> generalizes the remaining specification over the variable(s)
introduced between the curly braces.</li>
</ol>
<p>We finish the process of manually providing this specification by saving the
file and closing the editor, which brings us back to our interactive <code>scaffold</code>
session. As before, select <code>&lt;DONE&gt;</code> to write the changes to disk.</p>
<p>This is all we need to have Rocq check this more precise specification. Given
the simplicity of <code>swap</code>'s code, BlueRock's proof automation makes short work of
proving the function's correctness against the new specification.</p>
<pre class="language-shell"><code class="language-shell">$ dune b proof/stage2_cpp/</code></pre>
<p>Having successfully checked our proof, we can now be certain that <code>swap</code> does
indeed swap the contents of its two arguments.</p>


      </main>
    </div>

    <footer class="bd-footer py-4 py-md-5 mt-5 bg-body-tertiary">
      <center>
        <small>BlueRock Security, Inc. 2025
      </small></center>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script src="../../node_modules/lunr/lunr.min.js"></script>
    <script>
        (async function() {
            const searchInput = document.getElementById('searchInput');
            const searchResults = document.createElement('div');
            searchResults.id = 'searchResults';
            searchResults.classList.add('list-group', 'mt-2');
            document.body.appendChild(searchResults);

            let idx;
            let docs;

            try {
                const response = await fetch('/search.json');
                docs = await response.json();

                idx = lunr(function () {
                    this.ref('url');
                    this.field('title');
                    this.field('content');

                    docs.forEach(function (doc) {
                        this.add(doc);
                    }, this);
                });
            } catch (error) {
                console.error('Error loading search index:', error);
                return;
            }

            searchInput.addEventListener('input', function() {
                const query = this.value;
                searchResults.innerHTML = '';

                if (query.length > 2) {
                    const results = idx.search(query);
                    results.forEach(result => {
                        const doc = docs.find(d => d.url === result.ref);
                        if (doc) {
                            const a = document.createElement('a');
                            a.href = doc.url;
                            a.classList.add('list-group-item', 'list-group-item-action');
                            a.textContent = doc.title;
                            searchResults.appendChild(a);
                        }
                    });
                }
            });
        })();
    </script>
</body>
</html>
